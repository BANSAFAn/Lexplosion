<UserControl
    x:Class="Lexplosion.Gui.Views.CustomControls.SearchBox"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:System="clr-namespace:System;assembly=mscorlib"
    xmlns:cf="clr-namespace:Lexplosion.Logic.Objects.Curseforge"
    xmlns:controls="clr-namespace:Lexplosion.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extension="clr-namespace:Lexplosion.Gui.Extension"
    xmlns:lexplosion="clr-namespace:Lexplosion"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="40"
    d:DesignWidth="450"
    mc:Ignorable="d">
    <UserControl.Resources>

        <ObjectDataProvider
            x:Key="CfSortByEnum"
            MethodName="GetValues"
            ObjectType="{x:Type System:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="lexplosion:CfSortBy" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <Style x:Key="SearchButtonStyle" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Grid>
                            <Border
                                x:Name="Border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="#131313"
                                BorderThickness="0,1,1,1"
                                CornerRadius="0,5,5,0" />
                            <Viewbox Width="20" Height="20">
                                <Path
                                    Data="M26.9189 25.0593L18.154 16.2944C19.5142 14.5361 20.2499 12.3862 20.2499 10.125C20.2499 7.41822 19.1935 4.88023 17.2833 2.96661C15.3731 1.053 12.8283 0 10.125 0C7.42159 0 4.87685 1.05637 2.96661 2.96661C1.053 4.87685 0 7.41822 0 10.125C0 12.8283 1.05637 15.3731 2.96661 17.2833C4.87685 19.1969 7.41822 20.2499 10.125 20.2499C12.3862 20.2499 14.5327 19.5142 16.2911 18.1574L25.0559 26.9189C25.0816 26.9446 25.1121 26.965 25.1457 26.9789C25.1793 26.9928 25.2153 27 25.2516 27C25.288 27 25.324 26.9928 25.3576 26.9789C25.3912 26.965 25.4217 26.9446 25.4474 26.9189L26.9189 25.4508C26.9446 25.4251 26.965 25.3945 26.9789 25.361C26.9928 25.3274 27 25.2914 27 25.255C27 25.2187 26.9928 25.1827 26.9789 25.1491C26.965 25.1155 26.9446 25.085 26.9189 25.0593ZM15.4709 15.4709C14.0399 16.8986 12.1432 17.6849 10.125 17.6849C8.10671 17.6849 6.20997 16.8986 4.77898 15.4709C3.35136 14.0399 2.56499 12.1432 2.56499 10.125C2.56499 8.10671 3.35136 6.2066 4.77898 4.77898C6.20997 3.35136 8.10671 2.56499 10.125 2.56499C12.1432 2.56499 14.0433 3.34799 15.4709 4.77898C16.8986 6.20997 17.6849 8.10671 17.6849 10.125C17.6849 12.1432 16.8986 14.0433 15.4709 15.4709Z"
                                    Fill="#fff"
                                    Stretch="Fill"
                                    Stroke="#fff" />
                            </Viewbox>
                            <ContentPresenter />
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#141517" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SearchTextBox" TargetType="{x:Type TextBox}">
            <Setter Property="Foreground" Value="LightGray" />
            <Setter Property="VerticalAlignment" Value="Top" />
            <Setter Property="Background" Value="#151719" />
            <Setter Property="FontSize" Value="22" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}">
                        <Grid>
                            <Border
                                x:Name="Border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="#131513"
                                BorderThickness="1,1,0,1"
                                CornerRadius="5,0,0,5" />
                            <ScrollViewer x:Name="PART_ContentHost" Margin="5" />
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="{x:Type controls:DropdownMenu}">
            <Setter Property="Focusable" Value="False" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type controls:DropdownMenu}">
                        <Grid>
                            <CheckBox x:Name="PART_Toggle" IsChecked="{Binding IsOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                <CheckBox.Template>
                                    <ControlTemplate TargetType="{x:Type CheckBox}">
                                        <Border
                                            x:Name="Border"
                                            Padding="5"
                                            Background="{DynamicResource SepSolidColorBrush}"
                                            CornerRadius="5">
                                            <Viewbox Width="23">
                                                <Path
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    extension:PathExtension.StringData="{StaticResource Filter}"
                                                    Fill="White"
                                                    Stretch="Fill" />
                                            </Viewbox>

                                        </Border>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Border" Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect
                                                            BlurRadius="50"
                                                            Direction="270"
                                                            Opacity="0.2"
                                                            Color="{DynamicResource ActivityColor}" />
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>

                                    </ControlTemplate>
                                </CheckBox.Template>
                            </CheckBox>

                            <Popup
                                x:Name="PART_Popup"
                                AllowsTransparency="True"
                                IsOpen="{TemplateBinding IsOpen}"
                                Placement="Bottom"
                                PlacementTarget="{Binding ElementName=PART_Toggle}"
                                PopupAnimation="Fade"
                                StaysOpen="False"
                                VerticalOffset="10">
                                <Border
                                    Background="{DynamicResource HeaderSolidColorBrush}"
                                    BorderBrush="#424242"
                                    CornerRadius="5">
                                    <ContentControl Margin="2,7,2,7" Content="{TemplateBinding Content}" />
                                </Border>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <DataTemplate x:Key="CurseforgeCategory" DataType="{x:Type cf:CurseforgeCategory}">
            <Border
                x:Name="Border"
                Margin="3,2,0,0"
                Padding="10,3,10,3"
                BorderBrush="{DynamicResource BrandSolidColorBrush}"
                BorderThickness="1"
                CornerRadius="10"
                SnapsToDevicePixels="False">

                <StackPanel
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">

                    <!--  Catagory text  -->

                    <TextBlock
                        VerticalAlignment="Center"
                        FontFamily="{DynamicResource FuturaBookC}"
                        FontSize="16"
                        FontWeight="Bold"
                        Foreground="{DynamicResource BrandSolidColorBrush}"
                        Text="{Binding name}" />
                </StackPanel>
            </Border>

            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem}}, Path=IsSelected}" Value="True">
                    <Setter TargetName="Border" Property="Background">
                        <Setter.Value>
                            <SolidColorBrush Opacity="0.2" Color="{DynamicResource ActivityColor}" />
                        </Setter.Value>
                    </Setter>
                    <Setter TargetName="Border" Property="BorderThickness" Value="2" />
                </DataTrigger>
            </DataTemplate.Triggers>

        </DataTemplate>

    </UserControl.Resources>

    <StackPanel Orientation="Horizontal">

        <!--  Category Menu  -->
        <controls:DropdownMenu
            x:Name="FiltersDropdownMenu"
            Margin="5,0,5,0"
            Visibility="{Binding HasCategories, Converter={StaticResource ConvertBoolToVisibility}}">
            <StackPanel Margin="10">

                <!--  Version & Sort By  -->
                <StackPanel Orientation="Horizontal">

                    <!--  Game Version  -->
                    <StackPanel>

                        <TextBlock
                            FontSize="14"
                            Foreground="White"
                            Opacity="0.8"
                            Text="{DynamicResource gameVersion}" />

                        <ComboBox Margin="0,3,0,0" SelectedValue="{Binding SelectedVersion}" SelectedItem="0">
                            <ComboBox.ItemsSource>
                                <CompositeCollection>
                                    <ComboBoxItem Content="{DynamicResource allVersions}" IsSelected="True" />
                                    <CollectionContainer Collection="{Binding Source={StaticResource MainVM}, Path=ReleaseGameVersions}" />
                                </CompositeCollection>
                            </ComboBox.ItemsSource>
                        </ComboBox>

                    </StackPanel>

                    <!--  Sort by [Popularity, Date Created...]  -->
                    <StackPanel Margin="5,0,0,0">

                        <TextBlock
                            FontSize="14"
                            Foreground="White"
                            Opacity="0.8"
                            Text="{DynamicResource sortBy}" />

                        <ComboBox
                            Margin="0,3,0,0"
                            HorizontalContentAlignment="Left"
                            Background="{DynamicResource SepSolidColorBrush}"
                            ItemsSource="{Binding CfSortToString}"
                            SelectedValue="{Binding SelectedCfSortByString}" />

                    </StackPanel>

                </StackPanel>

                <!--  Header  -->
                <StackPanel Margin="10,10,10,10">
                    <TextBlock
                        FontSize="18"
                        FontWeight="Medium"
                        Foreground="White"
                        Opacity="0.8"
                        Text="{DynamicResource filterByCategory}" />

                    <TextBlock
                        Margin="0,3,0,0"
                        FontFamily="{DynamicResource FuturaBookC}"
                        FontSize="14"
                        FontWeight="Medium"
                        Foreground="White"
                        Opacity="0.7"
                        Text="{DynamicResource canSelectOnlyOne}" />
                </StackPanel>

                <ListBox
                    Width="290"
                    ItemContainerStyle="{StaticResource CategoriesListBoxItem}"
                    ItemTemplate="{StaticResource CurseforgeCategory}"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCurseforgeCategory}"
                    SelectionChanged="FiltersItem_SelectionChanged"
                    Style="{StaticResource CategoriesListBox}" />
            </StackPanel>
        </controls:DropdownMenu>

        <!--  SearchBox  -->
        <TextBox
            Width="243"
            Margin="10,0,0,0"
            HorizontalAlignment="Left"
            Background="{DynamicResource SepSolidColorBrush}"
            Style="{StaticResource SearchTextBox}"
            Text="{Binding SearchTextUncomfirmed, UpdateSourceTrigger=PropertyChanged}">
            <TextBox.InputBindings>
                <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
            </TextBox.InputBindings>
        </TextBox>

        <Button
            Width="43"
            Height="40"
            Background="{DynamicResource HeaderSolidColorBrush}"
            Command="{Binding SearchCommand}"
            Style="{StaticResource SearchButtonStyle}" />

        <!--  InstanceSource  -->
        <ComboBox
            x:Name="SourceBox"
            Grid.Column="4"
            Margin="10,3,0,0"
            VerticalAlignment="Top"
            SelectedIndex="{Binding SelectedSourceIndex}"
            Visibility="{Binding IsMultiSource, Converter={StaticResource ConvertBoolToVisibility}}">
            <ComboBoxItem>NightWorld</ComboBoxItem>
            <ComboBoxItem>CurseForge</ComboBoxItem>
        </ComboBox>
    </StackPanel>
</UserControl>
