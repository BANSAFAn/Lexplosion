<UserControl
    x:Class="Lexplosion.Gui.Views.Pages.FactoryMenu.FactoryDLCView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Lexplosion.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extension="clr-namespace:Lexplosion.Gui.Extension"
    xmlns:instances="clr-namespace:Lexplosion.Logic.Management.Instances"
    xmlns:lexplosion="clr-namespace:Lexplosion"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="450"
    d:DesignWidth="700"
    mc:Ignorable="d">
    <UserControl.Resources>

        <ControlTemplate x:Key="DLCHeaderControlTemplate">
            <Border
                Width="677"
                Background="Transparent"
                BorderBrush="#262626"
                BorderThickness="1"
                CornerRadius="5">
                <DockPanel LastChildFill="True">
                    <Border
                        Height="40"
                        Background="Transparent"
                        BorderBrush="#262626"
                        BorderThickness="0,0,0,1"
                        DockPanel.Dock="Top">
                        <Grid ShowGridLines="False">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="300" />
                                <ColumnDefinition Width="130" />
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Style="{StaticResource ExpanderHeaderContent}" Text="{DynamicResource instanceTitle}" />

                            <TextBlock
                                Grid.Column="1"
                                Style="{StaticResource ExpanderHeaderContent}"
                                Text="{DynamicResource author}" />

                            <TextBlock
                                Grid.Column="2"
                                Style="{StaticResource ExpanderHeaderContent}"
                                Text="{DynamicResource version}" />

                            <StackPanel
                                Grid.Column="3"
                                HorizontalAlignment="Right"
                                Orientation="Horizontal">

                                <!--  To Curseforge Market  -->
                                <Button
                                    Width="30"
                                    Height="30"
                                    Margin="0,0,0,0"
                                    Command="{Binding Content.OpenMarket}"
                                    CommandParameter="{Binding Content.CurrentAddonModel}"
                                    Style="{StaticResource IconicButton}">
                                    <Path Data="M 12 7 C 12.1989 7 12.3897 7.07902 12.5303 7.21967 C 12.671 7.36032 12.75 7.55109 12.75 7.75 V 11.25 H 16.25 C 16.4489 11.25 16.6397 11.329 16.7803 11.4697 C 16.921 11.6103 17 11.8011 17 12 C 17 12.1989 16.921 12.3897 16.7803 12.5303 C 16.6397 12.671 16.4489 12.75 16.25 12.75 H 12.75 V 16.25 C 12.75 16.4489 12.671 16.6397 12.5303 16.7803 C 12.3897 16.921 12.1989 17 12 17 C 11.8011 17 11.6103 16.921 11.4697 16.7803 C 11.329 16.6397 11.25 16.4489 11.25 16.25 V 12.75 H 7.75 C 7.55109 12.75 7.36032 12.671 7.21967 12.5303 C 7.07902 12.3897 7 12.1989 7 12 C 7 11.8011 7.07902 11.6103 7.21967 11.4697 C 7.36032 11.329 7.55109 11.25 7.75 11.25 H 11.25 V 7.75 C 11.25 7.55109 11.329 7.36032 11.4697 7.21967 C 11.6103 7.07902 11.8011 7 12 7 Z M 3 6.25 C 3 5.38805 3.34241 4.5614 3.9519 3.9519 C 4.5614 3.34241 5.38805 3 6.25 3 H 17.75 C 18.612 3 19.4386 3.34241 20.0481 3.9519 C 20.6576 4.5614 21 5.38805 21 6.25 V 17.75 C 21 18.612 20.6576 19.4386 20.0481 20.0481 C 19.4386 20.6576 18.612 21 17.75 21 H 6.25 C 5.38805 21 4.5614 20.6576 3.9519 20.0481 C 3.34241 19.4386 3 18.612 3 17.75 V 6.25 Z M 6.25 4.5 C 5.78587 4.5 5.34075 4.68437 5.01256 5.01256 C 4.68437 5.34075 4.5 5.78587 4.5 6.25 V 17.75 C 4.5 18.716 5.284 19.5 6.25 19.5 H 17.75 C 18.2141 19.5 18.6592 19.3156 18.9874 18.9874 C 19.3156 18.6592 19.5 18.2141 19.5 17.75 V 6.25 C 19.5 5.78587 19.3156 5.34075 18.9874 5.01256 C 18.6592 4.68437 18.2141 4.5 17.75 4.5 H 6.25 Z" Fill="White" />

                                    <Button.ToolTip>

                                        <ToolTip
                                            Content="{DynamicResource addModification}"
                                            HorizontalOffset="-120"
                                            Style="{StaticResource CustomTipTool}"
                                            VerticalOffset="-20" />
                                    </Button.ToolTip>

                                </Button>

                                <!--  Open Forlder  -->
                                <Button
                                    Width="30"
                                    Height="30"
                                    Margin="0,0,5,0"
                                    Command="{Binding Content.OpenAddonsFolder}"
                                    Style="{StaticResource IconicButton}">
                                    <Viewbox
                                        Width="22"
                                        Height="20"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Stretch="Fill">
                                        <Path Data="M7.05 40q-1.2 0-2.1-.925-.9-.925-.9-2.075V11q0-1.15.9-2.075Q5.85 8 7.05 8h14l3 3h17q1.15 0 2.075.925.925.925.925 2.075v23q0 1.15-.925 2.075Q42.2 40 41.05 40Zm0-29v26h34V14H22.8l-3-3H7.05Zm0 0v26Z" Fill="White" />
                                    </Viewbox>

                                    <Button.ToolTip>
                                        <ToolTip
                                            Content="{DynamicResource openfolder}"
                                            HorizontalOffset="-50"
                                            Style="{StaticResource CustomTipTool}"
                                            VerticalOffset="-20" />
                                    </Button.ToolTip>

                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                    <ItemsPresenter />
                </DockPanel>
            </Border>
        </ControlTemplate>

        <DataTemplate DataType="{x:Type instances:InstanceAddon}">
            <Grid Height="60" ShowGridLines="False">

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40" />
                    <ColumnDefinition Width="256" />
                    <ColumnDefinition Width="130" />
                    <ColumnDefinition Width="120" />
                    <ColumnDefinition Width="115" />
                </Grid.ColumnDefinitions>

                <!--  Logo  -->
                <Border
                    Grid.Column="0"
                    Width="40"
                    Height="40"
                    CornerRadius="5">

                    <Border.Background>
                        <ImageBrush ImageSource="{Binding Logo, Converter={StaticResource BytesToBitmapImageConverter}, IsAsync=True}" />
                    </Border.Background>

                </Border>

                <!--  Name  -->
                <TextBlock
                    Grid.Column="1"
                    Margin="10,0,0,10"
                    Style="{StaticResource DLCInfo}"
                    Text="{Binding Name}"
                    TextWrapping="WrapWithOverflow" />

                <!--  File Name  -->
                <TextBlock
                    Grid.Column="1"
                    Margin="10,25,0,0"
                    FontSize="11"
                    Opacity="0.8"
                    Style="{StaticResource DLCInfo}"
                    Text="{Binding FileName}"
                    TextWrapping="WrapWithOverflow" />

                <!--  Author  -->
                <TextBlock
                    Grid.Column="2"
                    FontSize="13"
                    Style="{StaticResource DLCInfo}"
                    Text="{Binding Author}"
                    TextWrapping="Wrap" />

                <!--  Version  -->
                <TextBlock
                    Grid.Column="3"
                    FontSize="13"
                    FontWeight="Normal"
                    Style="{StaticResource DLCInfo}"
                    Text="{Binding Version}"
                    TextWrapping="WrapWithOverflow" />

                <StackPanel
                    Grid.Column="4"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">

                    <ToggleButton Margin="5,0,0,0" IsChecked="{Binding IsEnable}">

                        <ToggleButton.ToolTip>
                            <ToolTip
                                Content="{DynamicResource startModification}"
                                HorizontalOffset="-70"
                                Style="{StaticResource CustomTipTool}"
                                VerticalOffset="-27" />
                        </ToggleButton.ToolTip>
                        <ToggleButton.Style>
                            <Style BasedOn="{StaticResource EllipseToggleButton}" TargetType="{x:Type ToggleButton}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding DataContext.CurrentAddonModel.Type, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}" Value="{x:Static lexplosion:CfProjectType.Resourcepacks}">
                                        <Setter Property="Border.Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding DataContext.CurrentAddonModel.Type, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}" Value="{x:Static lexplosion:CfProjectType.Resourcepacks}">
                                        <Setter Property="Border.Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ToggleButton.Style>
                    </ToggleButton>

                    <Button
                        Margin="5,0,0,0"
                        Command="{Binding DataContext.CurseforgeCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}}"
                        CommandParameter="{Binding WebsiteUrl}"
                        Style="{StaticResource IconicButton}"
                        Visibility="{Binding IsUrlExist, Converter={StaticResource ConvertBoolToVisibility}}">
                        <Viewbox Width="24" Height="12.84">
                            <Path
                                extension:PathExtension.StringData="{StaticResource CurseforgeLogo}"
                                Fill="White"
                                Stretch="Fill" />
                        </Viewbox>

                        <Button.ToolTip>
                            <ToolTip
                                Content="{DynamicResource curseforgePage}"
                                HorizontalOffset="-70"
                                Style="{StaticResource CustomTipTool}"
                                VerticalOffset="-27" />
                        </Button.ToolTip>

                    </Button>

                    <Button
                        Margin="8,0,0,0"
                        Command="{Binding DataContext.UpdateCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}}"
                        CommandParameter="{Binding}"
                        Style="{StaticResource IconicButton}"
                        Visibility="{Binding UpdateAvailable, Converter={StaticResource NegativeConvertBoolToVisibility}}">
                        <Viewbox Width="20" Height="20">
                            <Path
                                VerticalAlignment="Bottom"
                                extension:PathExtension.StringData="{StaticResource Update}"
                                Fill="White"
                                Stretch="Fill" />
                        </Viewbox>

                        <Button.ToolTip>
                            <ToolTip
                                Content="{DynamicResource update}"
                                HorizontalOffset="-30"
                                Style="{StaticResource CustomTipTool}"
                                VerticalOffset="-27" />
                        </Button.ToolTip>

                    </Button>

                    <Button
                        Margin="8,0,0,0"
                        Command="{Binding DataContext.UninstallAddonCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}}"
                        CommandParameter="{Binding}"
                        Style="{StaticResource IconicButton}">

                        <Viewbox Width="20" Height="20">
                            <Path
                                extension:PathExtension.StringData="{StaticResource Delete}"
                                Fill="White"
                                Stretch="Fill" />
                        </Viewbox>

                        <Button.ToolTip>
                            <ToolTip
                                Content="{DynamicResource delete}"
                                HorizontalOffset="-30"
                                Style="{StaticResource CustomTipTool}"
                                VerticalOffset="-27" />
                        </Button.ToolTip>

                    </Button>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <Style x:Key="ExpanderHeaderFocusVisual">
            <Setter Property="Control.Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Border />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DLCListBox" TargetType="{x:Type ListBox}">
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Background" Value="Transparent" />
        </Style>

        <Style x:Key="DLCListBoxItem" TargetType="{x:Type ListBoxItem}" />
    </UserControl.Resources>

    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="0,10,0,0">
                <TabControl
                    HorizontalAlignment="Center"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    ItemContainerStyle="{StaticResource ButtonItemBinableStyle}"
                    ItemsSource="{Binding AddonTabs}"
                    SelectedIndex="{Binding SelectedAddonIndex, UpdateSourceTrigger=PropertyChanged}"
                    TabStripPlacement="Top">

                    <TabControl.Resources>
                        <Style TargetType="{x:Type TabPanel}">
                            <Setter Property="HorizontalAlignment" Value="Center" />
                        </Style>
                    </TabControl.Resources>

                    <TabControl.ContentTemplate>
                        <!--  this is the body of the TabItem template  -->
                        <DataTemplate>
                            <StackPanel>
                                <ListBox
                                    ItemsSource="{Binding Content.CurrentAddonModel.InstalledAddons}"
                                    Tag="{Binding BindsDirectlyToSource=True}"
                                    Template="{StaticResource DLCHeaderControlTemplate}" />

                                <TextBlock
                                    Margin="100"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="20"
                                    Foreground="White"
                                    Opacity="0.8"
                                    Text="{Binding Content.CurrentAddonModel.EmptyListMessage}"
                                    Visibility="{Binding Content.CurrentAddonModel.IsEmptyList, Converter={StaticResource ConvertBoolToVisibility}}" />
                            </StackPanel>
                        </DataTemplate>

                    </TabControl.ContentTemplate>
                </TabControl>
            </StackPanel>
        </ScrollViewer>

        <controls:LoadingBoard
            BackgroundColor="#18191b"
            BackgroundOpacity="0.8"
            IsLoadingFinished="{Binding IsLoaded}"
            Placeholder="{DynamicResource loadingInstanceDLC}" />
    </Grid>
</UserControl>
